<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TFT Powerup Optimizer</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { 
      font-family: 'Segoe UI', Arial, sans-serif; 
      padding: 20px; 
      max-width: 1200px; 
      margin: auto; 
      line-height: 1.6;
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    h2 { 
      color: #2c3e50;
      text-align: center;
      margin-bottom: 10px;
    }
    .credits {
      text-align: center;
      font-size: 12px;
      color: #7f8c8d;
      margin-bottom: 25px;
    }
    .main-content {
      display: flex;
      gap: 20px;
      flex: 1;
    }
    .container {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      flex: 2;
    }
    .sidebar {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .info-panel {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .favorites-panel {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-height: 500px;
      overflow-y: auto;
    }
    label { 
      margin: 15px 0 5px;
      font-weight: bold;
      color: #2c3e50;
    }
    select, input, button { 
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 15px;
      width: 100%;
      box-sizing: border-box;
      font-size: 16px;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
      margin-top: 20px;
      padding: 12px;
    }
    button:hover {
      background-color: #2980b9;
    }
    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    ul { 
      padding-left: 0;
      list-style-type: none;
    }
    li { 
      margin-bottom: 10px;
      padding: 10px;
      background-color: white;
      border-radius: 4px;
      border-left: 4px solid #3498db;
    }
    .champion-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    .favorite-btn {
      background: none;
      border: none;
      color: #ccc;
      cursor: pointer;
      font-size: 18px;
      padding: 5px;
      margin-left: auto;
      transition: color 0.3s;
    }
    .favorite-btn:hover {
      color: #ff6b6b;
    }
    .favorite-btn.favorited {
      color: #ff6b6b;
    }
    .loading {
      text-align: center;
      color: #7f8c8d;
      font-style: italic;
    }
    .error {
      color: #e74c3c;
      font-weight: bold;
    }
    .success {
      color: #27ae60;
    }
    .highlight {
      font-weight: bold;
      color: #e67e22;
    }
    .powerup-info {
      margin-top: 20px;
    }
    .powerup-info h3 {
      margin-top: 0;
      color: #2c3e50;
    }
    .powerup-description {
      padding: 15px;
      background-color: #e8f4fc;
      border-radius: 4px;
    }
    .favorite-group {
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }
    .favorite-group-header {
      background-color: #3498db;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .favorite-group-header-content {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }
    .favorite-group-header strong,
    .favorite-group-header span {
      line-height: 1;
      vertical-align: baseline;
    }
    .favorite-group-content {
      padding: 10px;
      background-color: white;
    }
    .favorite-group-item {
      display: flex;
      align-items: center;
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    .favorite-group-item:last-child {
      border-bottom: none;
    }
    .group-remove-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      margin-left: 10px;
      padding: 0 5px;
    }
    .item-remove-btn {
      background: none;
      border: none;
      color: #e74c3c;
      cursor: pointer;
      margin-left: auto;
      padding: 2px 5px;
    }
    .favorites-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .clear-favorites {
      background: none;
      border: none;
      color: #e74c3c;
      cursor: pointer;
      font-size: 14px;
    }
 @media (max-width: 1024px) {
  .main-content {
    flex-direction: column;
    gap: 40px;
  }

  .container,
  .sidebar {
    flex: unset;
    width: 100%;
  }

  .container {
    order: 1;
  }

  .sidebar {
    order: 2;
  }

  .favorites-panel,
  .info-panel {
    max-height: none;
    overflow: visible;
  }
}

@media (max-width: 600px) {
  body {
    padding: 10px;
  }

  h2 {
    font-size: 22px;
  }

  label,
  select,
  input,
  button {
    font-size: 15px;
  }

  .champion-icon {
    width: 28px;
    height: 28px;
  }

  .favorite-btn {
    font-size: 16px;
  }

  .favorite-group-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 5px;
  }

  .favorite-group-item {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 8px;
  }
}
  </style>
</head>
<body>
  <h2>TFT Powerup Optimizer</h2>
  <div class="credits">by decarstes</div>

  <div class="main-content">
    <div class="container">
      <label for="langSelect">Idioma / Language:</label>
      <select id="langSelect">
        <option value="pt">Português</option>
        <option value="en">English</option>
      </select>

      <label for="championSelect">Champion:</label>
      <select id="championSelect" disabled>
        <option value="">Loading champions...</option>
      </select>

      <label for="powerupSelect">Powerup:</label>
      <select id="powerupSelect" disabled>
        <option value="">Select a champion first</option>
      </select>

      <button id="analyzeBtn" onclick="analisar()" disabled>Analyze</button>

      <h3>Best champions to use before:</h3>
      <ul id="resultList">
        <li class="loading">Select a champion and powerup to analyze</li>
      </ul>
    </div>

    <div class="sidebar">
      <div class="info-panel">
        <h3>Powerup Information</h3>
        <div class="powerup-info" id="powerupInfo" style="display: none;">
          <h4 id="powerupName"></h4>
          <div class="powerup-description" id="powerupDescription"></div>
        </div>
      </div>

      <div class="favorites-panel">
        <div class="favorites-title">
          <h3>Favorites <i class="fas fa-heart" style="color: #ff6b6b;"></i></h3>
          <button class="clear-favorites" onclick="clearFavorites()">Clear All</button>
        </div>
        <ul id="favoritesList">
          <li class="loading">No favorites yet</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    let data = [];
    let currentLanguage = 'pt';
    let championData = {};
    let powerupDescriptions = {};
    let favorites = JSON.parse(localStorage.getItem('tft_favorites')) || [];

    const champSelect = document.getElementById("championSelect");
    const powerupSelect = document.getElementById("powerupSelect");
    const resultList = document.getElementById("resultList");
    const langSelect = document.getElementById("langSelect");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const powerupInfo = document.getElementById("powerupInfo");
    const powerupName = document.getElementById("powerupName");
    const powerupDescription = document.getElementById("powerupDescription");
    const favoritesList = document.getElementById("favoritesList");

    function formatChampionNameForIcon(championName) {
      return championName
        .toLowerCase()
        .replace(/'/g, '')
        .replace(/\./g, '')
        .replace(/\s+/g, '')
        .replace(/[^a-z0-9]/g, '');
    }

    function getChampionIcon(championName) {
      const formattedName = formatChampionNameForIcon(championName);
      return `https://cdn.metatft.com/cdn-cgi/image/width=48,height=48,format=auto/https://cdn.metatft.com/file/metatft/champions/tft15_${formattedName}.png`;
    }

    function showLoading() {
      resultList.innerHTML = '<li class="loading">Loading data...</li>';
    }

    function showError(message) {
      resultList.innerHTML = `<li class="error">${message}</li>`;
    }

    async function carregarDados() {
      showLoading();
      currentLanguage = langSelect.value;
      
      try {
        const [championsResponse, descriptionsResponse] = await Promise.all([
          fetch(`./tft_powerups_${currentLanguage}.json?${new Date().getTime()}`),
          fetch(`./tft_powerup_desc_${currentLanguage}.json?${new Date().getTime()}`)
        ]);
        
        if (!championsResponse.ok) throw new Error(`HTTP error! status: ${championsResponse.status}`);
        if (!descriptionsResponse.ok) throw new Error(`HTTP error! status: ${descriptionsResponse.status}`);
        
        const [loadedData, loadedDescriptions] = await Promise.all([
          championsResponse.json(),
          descriptionsResponse.json()
        ]);
        
        data = loadedData;
        powerupDescriptions = {};
        
        loadedDescriptions.forEach(desc => {
          powerupDescriptions[desc.nome || desc.name] = {
            description: desc.descricao || desc.description
          };
        });
        
        championData = {};
        data.forEach(entry => {
          championData[entry.champion] = {
            powerups: entry.powerups,
          };
        });
        
        preencherCampeoes();
        updateFavoritesList();
      } catch (error) {
        console.error("Error loading file:", error);
        showError(currentLanguage === 'pt' 
          ? "Erro ao carregar os dados. Por favor, tente recarregar a página." 
          : "Error loading data. Please try reloading the page.");
      }
    }

    function preencherCampeoes() {
      champSelect.innerHTML = "";
      
      const sortedChampions = [...data].sort((a, b) => a.champion.localeCompare(b.champion));
      
      sortedChampions.forEach(entry => {
        const opt = document.createElement("option");
        opt.value = entry.champion;
        
        const iconUrl = getChampionIcon(entry.champion);
        opt.innerHTML = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <img src="${iconUrl}" alt="${entry.champion}" style="width: 20px; height: 20px; border-radius: 50%;">
            ${entry.champion}
          </div>
        `;
        
        champSelect.appendChild(opt);
      });
      
      champSelect.disabled = false;
      analyzeBtn.textContent = currentLanguage === 'pt' ? 'Analisar' : 'Analyze';
      
      if (data.length > 0) {
        champSelect.selectedIndex = 0;
        atualizarFrutas();
      }
    }

    function atualizarFrutas() {
      const selectedChampion = champSelect.value;
      const champion = championData[selectedChampion];
      
      powerupSelect.innerHTML = "";
      
      if (champion) {
        const sortedPowerups = [...champion.powerups].sort((a, b) => a.localeCompare(b));
        
        sortedPowerups.forEach(p => {
          const opt = document.createElement("option");
          opt.value = p;
          opt.textContent = p;
          powerupSelect.appendChild(opt);
        });
        
        powerupSelect.disabled = false;
        analyzeBtn.disabled = false;
        updatePowerupInfo();
      } else {
        powerupSelect.disabled = true;
        analyzeBtn.disabled = true;
      }
    }

    function updatePowerupInfo() {
      const selectedPowerup = powerupSelect.value;
      
      if (selectedPowerup && powerupDescriptions[selectedPowerup]) {
        powerupName.textContent = selectedPowerup;
        powerupDescription.textContent = powerupDescriptions[selectedPowerup].description;
        powerupInfo.style.display = 'block';
      } else {
        powerupInfo.style.display = 'none';
      }
    }

    function toggleFavorite(targetChampion, powerup, recommendedChampion) {
      const existingIndex = favorites.findIndex(fav => 
        fav.target === targetChampion && 
        fav.powerup === powerup && 
        fav.recommended === recommendedChampion
      );
      
      if (existingIndex === -1) {
        favorites.push({
          target: targetChampion,
          powerup: powerup,
          recommended: recommendedChampion,
          timestamp: new Date().getTime()
        });
      } else {
        favorites.splice(existingIndex, 1);
      }
      
      favorites.sort((a, b) => b.timestamp - a.timestamp);
      
      localStorage.setItem('tft_favorites', JSON.stringify(favorites));
      updateFavoritesList();
      updateFavoriteButtons(targetChampion, powerup);
    }

    function clearFavorites() {
      if (confirm(currentLanguage === 'pt' 
          ? "Tem certeza que deseja limpar todos os favoritos?" 
          : "Are you sure you want to clear all favorites?")) {
        favorites = [];
        localStorage.setItem('tft_favorites', JSON.stringify(favorites));
        updateFavoritesList();
      }
    }

    function loadFavoriteCombo(favorite) {
      champSelect.value = favorite.target;
      champSelect.dispatchEvent(new Event('change'));
      
      setTimeout(() => {
        powerupSelect.value = favorite.powerup;
        powerupSelect.dispatchEvent(new Event('change'));
        analisar();
      }, 100);
    }

    function updateFavoritesList() {
      favoritesList.innerHTML = "";
      
      if (favorites.length === 0) {
        favoritesList.innerHTML = `<li class="loading">${
          currentLanguage === 'pt' 
            ? "Nenhum favorito ainda" 
            : "No favorites yet"
        }</li>`;
        return;
      }

      const groupedFavorites = {};
      favorites.forEach(fav => {
        const key = `${fav.target}|${fav.powerup}`;
        if (!groupedFavorites[key]) {
          groupedFavorites[key] = {
            target: fav.target,
            powerup: fav.powerup,
            items: []
          };
        }
        groupedFavorites[key].items.push(fav);
      });

      const sortedGroups = Object.values(groupedFavorites)
        .sort((a, b) => {
          const aLatest = Math.max(...a.items.map(i => i.timestamp));
          const bLatest = Math.max(...b.items.map(i => i.timestamp));
          return bLatest - aLatest;
        });

      sortedGroups.forEach(group => {
        const groupElement = document.createElement('div');
        groupElement.className = 'favorite-group';
        
        const targetIcon = getChampionIcon(group.target);
        
        groupElement.innerHTML = `
          <div class="favorite-group-header">
            <div class="favorite-group-header-content">
              <img src="${targetIcon}" alt="${group.target}" style="width: 20px; height: 20px; border-radius: 50%;">
              <strong>${group.target}</strong>
              <span>+ ${group.powerup}</span>
            </div>
            <button class="group-remove-btn" onclick="removeFavoriteGroup('${group.target.replace(/'/g, "\\'")}', '${group.powerup.replace(/'/g, "\\'")}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="favorite-group-content" id="group-${group.target}-${group.powerup}">
          </div>
        `;
        
        favoritesList.appendChild(groupElement);
        
        const groupContent = document.getElementById(`group-${group.target}-${group.powerup}`);
        group.items.forEach(fav => {
          const itemElement = document.createElement('div');
          itemElement.className = 'favorite-group-item';
          
          const recommendedIcon = getChampionIcon(fav.recommended);
          
          itemElement.innerHTML = `
            <img src="${recommendedIcon}" alt="${fav.recommended}" style="width: 20px; height: 20px; border-radius: 50%; margin-right: 8px;">
            <span>${fav.recommended}</span>
            <button class="item-remove-btn" onclick="removeFavoriteItem(event, '${fav.target.replace(/'/g, "\\'")}', '${fav.powerup.replace(/'/g, "\\'")}', '${fav.recommended.replace(/'/g, "\\'")}')">
              <i class="fas fa-times"></i>
            </button>
          `;
          
          groupContent.appendChild(itemElement);
        });
      });
    }

    function removeFavoriteGroup(target, powerup) {
      if (confirm(currentLanguage === 'pt' 
          ? `Remover todas as recomendações para ${target} + ${powerup}?` 
          : `Remove all recommendations for ${target} + ${powerup}?`)) {
        favorites = favorites.filter(fav => 
          !(fav.target === target && fav.powerup === powerup)
        );
        localStorage.setItem('tft_favorites', JSON.stringify(favorites));
        updateFavoritesList();
        updateFavoriteButtons(target, powerup);
      }
    }

    function removeFavoriteItem(event, target, powerup, recommended) {
      event.stopPropagation();
      favorites = favorites.filter(fav => 
        !(fav.target === target && 
          fav.powerup === powerup && 
          fav.recommended === recommended)
      );
      localStorage.setItem('tft_favorites', JSON.stringify(favorites));
      updateFavoritesList();
      updateFavoriteButtons(target, powerup);
    }

    function updateFavoriteButtons(targetChampion, powerup) {
      document.querySelectorAll('.favorite-btn').forEach(btn => {
        const recommendedChampion = btn.getAttribute('data-champion');
        const isFavorite = favorites.some(fav => 
          fav.target === targetChampion && 
          fav.powerup === powerup && 
          fav.recommended === recommendedChampion
        );
        
        if (isFavorite) {
          btn.classList.add('favorited');
        } else {
          btn.classList.remove('favorited');
        }
      });
    }

    function analisar() {
      if (data.length === 0) {
        showError(currentLanguage === 'pt' 
          ? "Dados ainda não carregados. Aguarde." 
          : "Data not loaded yet. Please wait.");
        return;
      }

      const alvoNome = champSelect.value;
      const frutaDesejada = powerupSelect.value.trim().toLowerCase();
      const alvo = championData[alvoNome];
      
      if (!alvo || !frutaDesejada) {
        showError(currentLanguage === 'pt' 
          ? "Por favor, preencha todos os campos corretamente." 
          : "Please fill all fields correctly.");
        return;
      }

      const poolAlvo = new Set(alvo.powerups.map(p => p.toLowerCase()));
      
      if (!poolAlvo.has(frutaDesejada)) {
        showError(currentLanguage === 'pt' 
          ? `⚠️ O campeão ${alvoNome} não possui a fruta "${powerupSelect.value}".` 
          : `⚠️ Champion ${alvoNome} doesn't have the "${powerupSelect.value}" powerup.`);
        return;
      }

      resultList.innerHTML = '<li class="loading">Analyzing combinations...</li>';
      
      setTimeout(() => {
        const candidatos = data
          .filter(c => c.champion !== alvoNome && !c.champion.includes('[H]'))
          .map(c => {
            const comum = c.powerups.filter(p => poolAlvo.has(p.toLowerCase()));
            const possuiFruta = c.powerups.some(p => p.toLowerCase() === frutaDesejada);
            const isFavorite = favorites.some(fav => 
              fav.target === alvoNome && 
              fav.powerup === powerupSelect.value && 
              fav.recommended === c.champion
            );
            
            return {
              nome: c.champion,
              comuns: comum,
              exclui: comum.length,
              temFrutaDesejada: possuiFruta,
              icon: getChampionIcon(c.champion),
              isFavorite: isFavorite
            };
          })
          .filter(c => !c.temFrutaDesejada && c.exclui > 0)
          .sort((a, b) => b.exclui - a.exclui || a.nome.localeCompare(b.nome));

        exibirResultados(candidatos, alvoNome, powerupSelect.value);
      }, 50);
    }

    function exibirResultados(candidatos, alvoNome, frutaDesejada) {
      resultList.innerHTML = "";
      
      if (candidatos.length === 0) {
        showError(currentLanguage === 'pt' 
          ? `Nenhum campeão encontrado que exclua frutas em comum com ${alvoNome} sem ter "${frutaDesejada}".` 
          : `No champions found that exclude common powerups with ${alvoNome} without having "${frutaDesejada}".`);
        return;
      }

      const header = document.createElement('li');
      header.innerHTML = currentLanguage === 'pt' 
        ? `<span class="highlight">Resultados para ${alvoNome} com "${frutaDesejada}":</span>` 
        : `<span class="highlight">Results for ${alvoNome} with "${frutaDesejada}":</span>`;
      resultList.appendChild(header);

      candidatos.forEach(c => {
        const li = document.createElement("li");
        
        li.innerHTML = `
          <img src="${c.icon}" alt="${c.nome}" class="champion-icon">
          <div>
            <strong>${c.nome}</strong> (${
              currentLanguage === 'pt' 
                ? `exclui ${c.exclui} frutas` 
                : `excludes ${c.exclui} powerups`
            }: ${c.comuns.join(", ")})
          </div>
          <button class="favorite-btn ${c.isFavorite ? 'favorited' : ''}" 
                  onclick="toggleFavorite('${alvoNome.replace(/'/g, "\\'")}', '${frutaDesejada.replace(/'/g, "\\'")}', '${c.nome.replace(/'/g, "\\'")}')"
                  data-champion="${c.nome.replace(/'/g, "\\'")}">
            <i class="fas fa-heart"></i>
          </button>
        `;
        resultList.appendChild(li);
      });
    }

    // Event listeners
    langSelect.addEventListener("change", carregarDados);
    champSelect.addEventListener("change", atualizarFrutas);
    powerupSelect.addEventListener("change", updatePowerupInfo);
    
    // Carregamento inicial
    document.addEventListener('DOMContentLoaded', carregarDados);
  </script>
</body>
</html>

</html>

